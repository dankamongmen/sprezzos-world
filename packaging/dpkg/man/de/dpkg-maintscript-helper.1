.\" dpkg manual page - dpkg-maintscript-helper(1)
.\"
.\" Copyright Â© 2010-2012 RaphaÃ«l Hertzog <hertzog@debian.org>
.\"
.\" This is free software; you can redistribute it and/or modify
.\" it under the terms of the GNU General Public License as published by
.\" the Free Software Foundation; either version 2 of the License, or
.\" (at your option) any later version.
.\"
.\" This is distributed in the hope that it will be useful,
.\" but WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
.\" GNU General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program.  If not, see <http://www.gnu.org/licenses/>.
.
.\"*******************************************************************
.\"
.\" This file was generated with po4a. Translate the source file.
.\"
.\"*******************************************************************
.TH dpkg\-maintscript\-helper 1 2012\-05\-04 Debian\-Projekt dpkg\-Programmsammlung
.SH NAME
dpkg\-maintscript\-helper \- Bekannte Einschränkungen in Dpkg in
Betreuerskripten umgehen
.
.SH ÜBERSICHT
\fBdpkg\-maintscript\-helper\fP \fIBefehl\fP [\fIParameter\fP ?] \fB\-\-\fP
\fIBetr\-Skript\-Parameter\fP ?
.
.SH "BEFEHLE UND PARAMETER"
.P
\fBrm_conffile\fP \fIConffile\fP [\fIvorhergehende_Version\fP [\fIPaket\fP]]
.P
\fBmv_conffile\fP \fIalte_Conffile\fP \fIneue_Conffile\fP [\fIvorhergehende_Version\fP
[\fIPaket\fP]]
.
.SH BESCHREIBUNG
.P
Dieses Programm wurde so entworfen, dass es in Betreuerskripten ausgeführt
werden kann, um einige Aufgaben zu erledigen, die Dpkg (noch) nicht selbst
erledigen kann, entweder aufgrund von Design\-Entscheidungen oder aufgrund
aktueller Einschränkungen.
.P
Viele dieser Aufgaben benötigen koordinierte Aktionen aus mehreren
Betreuerskripten (\fBpreinst\fP, \fBpostinst\fP, \fBprerm\fP, \fBpostrm\fP). Um Fehler
zu vermeiden, wird der gleiche Aufruf einfach in alle Skripte eingefügt und
das Programm wird sein Verhalten automatisch abhängig von der Variable
\fBDPKG_MAINTSCRIPT_NAME\fP und den Argumenten im Betreuerskript, die Sie nach
einem doppelten Schrägstrich übergeben müssen, anpassen.
.
.SH "CONFFILE\-BEZOGENE AUFGABEN"
.P
Beim Upgrade eines Pakets wird Dpkg ein Conffile (eine Konfigurationsdatei,
bei der Dpkg die Änderungen des Benutzers erhalten soll) nicht automatischen
entfernen, falls sie nicht in der neueren Version enthalten ist. Es gibt
zwei Hauptgründe dafür; der erste ist, dass die Conffile versehentlich
entfallen sein und die nächste Version sie wieder herstellen könnte und die
Benutzer die Änderung nicht weggeworfen sehen wollen. Der zweite besteht
darin, dass Paketen erlaubt werden soll, von einer Dpkg\-betreuten Conffile
auf eine Datei, die von den Betreuerskripten des Pakets, normalerweise mit
einem Werkzeug wie Debconf oder Ucf, verwaltet wird, umzustellen.
.P
Das bedeutet, falls ein Paket eine Conffile umbenennen oder entfernen soll,
muss es dies explizit durchführen und \fBdpkg\-maintscript\-helper\fP kann dazu
verwandt werden, eine sanfte Löschung und Verschiebung von Conffiles
innerhalb von Betreuerskripten durchzuführen.
.
.SS "EINE CONFFILE ENTFERNEN"
.P
Falls eine Conffile komplett entfernt wird, sollte sie von der Platte
entfernt werden, falls der Benutzer sie nicht verändert hat. Falls es lokale
Anpassungen gibt, sollten diese erhalten werden. Falls das Upgrade des
Pakets abgebrochen wird, sollte die neuerdings veraltete Conffile nicht
verschwinden.
.P
All dies wird durch Einsetzen der folgenden Shell\-Schnipsel in die
Betreuerskripte \fBpreinst\fP, \fBpostinst\fP und \fBpostrm\fP implementiert:
.P
    dpkg\-maintscript\-helper rm_conffile \e
        \fIConffile\fP \fIvorhergehende_Version\fP \fIPaket\fP \-\- "$@"
.P
\fIConffile\fP ist der Dateiname der zu entfernenden Conffile.
.P
\fIvorhergehende_Version\fP definiert die letzte Version des Pakets, dessen
Upgrade die Entfernung auslösen soll. Es ist wichtig, dass
\fIvorhergehende_Version\fP korrekt berechnet wird, so dass Conffiles korrekt
entfernt werden, selbst falls der Benutzer das Paket mit einer lokalen
Version neu gebaut hat. Wird beispielsweise eine Conffile in Version
\fB2.0\-1\fP eines Pakets entfernt, sollte \fIvorhergehende_Version\fP auf
\fB2.0\-1~\fP gesetzt werden. Dies führt dazu, dass das Conffile entfernt wird,
selbst falls der Benutzer die vorhergehende Version \fB1.0\-1\fP als
\fB1.0\-1local1\fP neu gebaut hat.
.P
Falls das Conffile in mehreren Versionen nicht ausgeliefert wurde und Sie
jetzt die Betreuerskripte anpassen, um die überflüssige Datei zu entfernen,
sollte \fIvorhergehende_Version\fP auf die Version des Pakets gesetzt werden,
die Sie jetzt zusammenstellen, nicht auf die erste Version des Pakets, bei
dem das Conffile fehlte.
.P
\fIPaket\fP ist der Paketname. Falls leer oder nicht angegeben wird die (von
Dpkg gesetzte) Umgebungsvariable DPKG_MAINTSCRIPT_PACKAGE verwandt.
.P
Alle Parameter der Betreuerskripte müssen nach »\-\-« an das Programm
weitergeleitet werden.
.P
Aktuelle Implementierung: im \fBpreinst\fP wird geprüft, ob die Conffile
geändert wurde. Dann wird sie entweder in \fIConffile\fP\fB.dpkg\-remove\fP (falls
sie nicht geändert wurde) oder in \fIConffile\fP\fB.dpkg\-backup\fP (falls sie
geändert wurde) umbenannt. Im \fBpostinst\fP wird letztere in
\fIConffile\fP\fB.dpkg\-bak\fP umbenannt und als Referenz behalten, da sie
Benutzeränderungen enthält, während erstere entfernt wird. Falls das Upgrade
des Pakets abgebrochen wird, reinstalliert \fBpostrm\fP die ursprüngliche
Conffile. Während des vollständigen Löschens wird \fBpostrm\fP auch die bisher
behaltene Datei \fB.dpkg\-bak\fP entfernen.
.
.SS "EINE CONFFILE UMBENENNEN"
.P
Falls eine Conffile von einem Ort zu einem anderen verschoben wird, müssen
Sie sicherstellen, dass Sie auch alle Änderungen des Benutzers mit
übernehmen. Anfänglich erscheint dies als einfache Änderung am Skript
\fBpreinst\fP, allerdings wird dies dazu führen, dass der Benutzer von Dpkg
aufgefordert wird, die Bearbeitung der Conffile zu bestätigen, obwohl sie
für diese gar nicht verantwortlich sind.
.P
Sanfte Umbenennung kann durch Einsetzen der folgenden Shell\-Schnipsel in die
Betreuerskripte \fBpreinst\fP, \fBpostinst\fP und \fBpostrm\fP implementiert werden:
.P
    dpkg\-maintscript\-helper mv_conffile \e
        \fIalte_Conffile\fP \fIneue_Conffile\fP \fIvorhergehende_Version\fP \fIPaket\fP \-\- "$@"
.P
\fIalte_Conffile\fP und \fIneue_Conffile\fP sind der alte und der neue Name der
umzubenennenden Conffile.
.P
\fIvorhergehende_Version\fP definiert die letzte Version des Pakets, dessen
Upgrade die Umbenennung der Conffile auslösen soll (siehe die Anmerkungen
für \fBrm_conffile\fP weiter oben in Bezug auf die korrekte Version). Falls
\fIvorhergehende_Version\fP leer ist oder weggelassen wurde wird die
Umbenennung bei jedem Upgrade versucht (Hinweis: Es ist sicherer, die
Version anzugeben und damit nur einmal versuchen zu lassen, die Datei
umzubenennen).
.P
\fIPaket\fP ist der Paketname. Falls leer oder nicht angegeben wird die (von
Dpkg gesetzte) Umgebungsvariable DPKG_MAINTSCRIPT_PACKAGE verwandt.
.P
Alle Parameter der Betreuerskripte müssen nach »\-\-« an das Programm
weitergeleitet werden.
.P
Aktuelle Implementierung: das \fBpreinst\fP überprüft, ob die Conffile
verändert wurde, falls ja, verbleibt sie am Platz, andernfalls wird sie in
\fIalte_Conffile\fP\fB.dpkg\-remove\fP umbenannt. Bei der Konfiguration entfernt
das \fBpostinst\fP \fIalte_Conffile\fP\fB.dpkg\-remove\fP und bennent \fIalte_Conffile\fP
in \fIneue_Conffile\fP um, falls \fIalte_Conffile\fP noch existiert. Falls
abort\-upgrade/abort\-install eintritt, benennt das \fBpostrm\fP wieder
\fIalte_Conffile\fP\fB.dpkg\-remove\fP in \fIalte_Conffile\fP zurück, falls notwendig.
.
.SH "INTEGRATION IN PAKETE"
.P
Da \fBdpkg\-maintscript\-helper\fP im \fBpreinst\fP verwandt wird, benötigt der
bedingungslose Einsatz eine pre\-Abhängigkeit (\fIpre\-dependency\fP), um
sicherzustellen, dass die Mindestversion von Dpkg breits entpackt wurde. Die
benötigte Version hängt vom verwandten Befehl ab, für \fBrm_conffile\fP und
\fBmv_conffile\fP lautet sie 1.15.7.2:
.P
    \fBPre\-Depends:\fP dpkg (>= 1.15.7.2)
.P
In vielen Fällen sind aber die Ausführungen des Programms für das Paket
nicht kritisch und statt einer pre\-Abhängigkeit soll das Programm nur
aufgerufen werden, falls bekannt ist, dass der benötigte Befehl vom derzeit
installierten Dpkg unterstützt wird:
.P
    if dpkg\-maintscript\-helper supports \fIcommand\fP; then
        dpkg\-maintscript\-helper \fIcommand\fP ?
    fi
.SH ÜBERSETZUNG
Die deutsche Übersetzung wurde 2004, 2006-2012 von Helge Kreutzmann
<debian@helgefjell.de>, 2007 von Florian Rehnisch <eixman@gmx.de> und
2008 von Sven Joachim <svenjoac@gmx.de>
angefertigt. Diese Übersetzung ist Freie Dokumentation; lesen Sie die
GNU General Public License Version 2 oder neuer für die Kopierbedingungen.
Es gibt KEINE HAFTUNG.
